# 5. Docker 컨테이너 외부 노출

## 1. 컨테이너 내부 IP 확인

컨테이너 내부에서 ifconfig 명령어로 네트워크 인터페이스를 확인할 수 있습니다.

```bash
root@530767fe28af:/# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255
        ether a6:5e:83:b2:21:7b  txqueuelen 0  (Ethernet)
        RX packets 12742  bytes 40340608 (40.3 MB)
        TX packets 9125   bytes 606653 (606.6 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX errors 0  dropped 0  overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        TX packets 0  bytes 0 (0.0 B)
```

eth0의 IP (172.17.0.2)가 컨테이너 내부 네트워크 주소
컨테이너를 외부에서 접근하려면 호스트 IP와 포트를 바인딩해야 함

## 2. 컨테이너 포트 매핑

```bash
docker create -it \
--name myApach2 \
-p 80:80 \
ubuntu:22.04
```

-p 호스트포트:컨테이너포트 형식으로 설정
호스트 80번 포트를 컨테이너 80번 포트와 연결 3. 브리지 네트워크 구축

## 3.1 사용자 정의 브리지 네트워크 생성

```bash
docker network create wp-network
```

같은 네트워크에 연결된 컨테이너는 컨테이너 이름으로 서로 접근 가능

## 4. DB 컨테이너 구축

```bash
docker run -d \
--name db-maria \
--network wp-network \
-p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=rootPw \
-e MYSQL_DATABASE=db_test \
mariadb
```

MYSQL_ROOT_PASSWORD : 루트 계정 비밀번호
MYSQL_DATABASE : 초기 생성 DB

## 5. WebApp 컨테이너 구축

```bash
docker run -d \
--name wordpress \
--network wp-network \
-e WORDPRESS_DB_HOST=db-maria:3306 \
-e WORDPRESS_DB_USER=root \
-e WORDPRESS_DB_PASSWORD=rootPw \
-e WORDPRESS_DB_NAME=db_test \
-p 80:80 \
wordpress
```

### 5.1 실행 결과 확인

```bash
docker ps
```

예시:

```bash
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
af9926fd684d wordpress "docker-entrypoint.s…" 6 seconds ago Up 5 seconds 0.0.0.0:32769->80/tcp, [::]:32769->80/tcp wordpress
9beef5520cf1 mariadb "docker-entrypoint.s…" 44 seconds ago Up 44 seconds 0.0.0.0:3306->3306/tcp, [::]:3306->3306/tcp db-maria
```

### 5.2 WebApp 컨테이너 내부에서 환경 변수 확인

```bash
docker exec -it wordpress /bin/bash
root@af9926fd684d:/var/www/html# echo ${WORDPRESS_DB_HOST}
db-maria:3306
```
